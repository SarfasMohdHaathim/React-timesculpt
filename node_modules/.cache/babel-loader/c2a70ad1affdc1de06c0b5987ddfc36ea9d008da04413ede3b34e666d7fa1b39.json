{"ast":null,"code":"import axios from\"axios\";import{jwtDecode}from\"jwt-decode\";import dayjs from\"dayjs\";import{useContext}from\"react\";import AuthContext from\"../context/AuthContext\";const baseURL=\"https://timesculpt.pythonanywhere.com/api/\";const useAxios=()=>{const{authTokens,setUser,setAuthTokens}=useContext(AuthContext);const axiosInstance=axios.create({baseURL,headers:{Authorization:\"Bearer \".concat(authTokens===null||authTokens===void 0?void 0:authTokens.access)}});axiosInstance.interceptors.request.use(async req=>{const user=jwtDecode(authTokens.access);const isExpired=dayjs.unix(user.exp).diff(dayjs())<1;if(!isExpired)return req;const response=await axios.post(\"\".concat(baseURL,\"token/refresh/\"),{refresh:authTokens.refresh});localStorage.setItem(\"authTokens\",JSON.stringify(response.data));setAuthTokens(response.data);setUser(jwtDecode(response.data.access));req.headers.Authorization=\"Bearer \".concat(jwtDecode(response.data.access));return req;});return axiosInstance;};export default useAxios;","map":{"version":3,"names":["axios","jwtDecode","dayjs","useContext","AuthContext","baseURL","useAxios","authTokens","setUser","setAuthTokens","axiosInstance","create","headers","Authorization","concat","access","interceptors","request","use","req","user","isExpired","unix","exp","diff","response","post","refresh","localStorage","setItem","JSON","stringify","data"],"sources":["D:/REACT/react-django-jwt/frontend/src/utils/useAxios.js"],"sourcesContent":["import axios from \"axios\";\r\nimport { jwtDecode } from \"jwt-decode\";\r\nimport dayjs from \"dayjs\";\r\nimport { useContext } from \"react\";\r\nimport AuthContext from \"../context/AuthContext\";\r\n\r\nconst baseURL = \"https://timesculpt.pythonanywhere.com/api/\";\r\n\r\nconst useAxios = () => {\r\n    const {authTokens, setUser, setAuthTokens } = useContext(AuthContext)\r\n\r\n    const axiosInstance = axios.create({\r\n        baseURL,\r\n        headers: {\r\n            Authorization : `Bearer ${authTokens?.access}`\r\n        }\r\n    })\r\n\r\n    axiosInstance.interceptors.request.use(\r\n        async req => {\r\n            const user = jwtDecode(authTokens.access)\r\n            const isExpired = dayjs.unix(user.exp).diff(dayjs()) < 1;\r\n\r\n            if (!isExpired) return req;\r\n\r\n            const response = await axios.post(`${baseURL}token/refresh/`, {\r\n                refresh: authTokens.refresh\r\n            });\r\n            localStorage.setItem(\"authTokens\", JSON.stringify(response.data))\r\n\r\n            setAuthTokens(response.data);\r\n            setUser(jwtDecode(response.data.access))\r\n\r\n            req.headers.Authorization = `Bearer ${jwtDecode(response.data.access)}`\r\n\r\n            return req;\r\n        }\r\n    )\r\n\r\n    return axiosInstance\r\n}\r\n\r\nexport default useAxios;"],"mappings":"AAAA,MAAO,CAAAA,KAAK,KAAM,OAAO,CACzB,OAASC,SAAS,KAAQ,YAAY,CACtC,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,OAASC,UAAU,KAAQ,OAAO,CAClC,MAAO,CAAAC,WAAW,KAAM,wBAAwB,CAEhD,KAAM,CAAAC,OAAO,CAAG,4CAA4C,CAE5D,KAAM,CAAAC,QAAQ,CAAGA,CAAA,GAAM,CACnB,KAAM,CAACC,UAAU,CAAEC,OAAO,CAAEC,aAAc,CAAC,CAAGN,UAAU,CAACC,WAAW,CAAC,CAErE,KAAM,CAAAM,aAAa,CAAGV,KAAK,CAACW,MAAM,CAAC,CAC/BN,OAAO,CACPO,OAAO,CAAE,CACLC,aAAa,WAAAC,MAAA,CAAaP,UAAU,SAAVA,UAAU,iBAAVA,UAAU,CAAEQ,MAAM,CAChD,CACJ,CAAC,CAAC,CAEFL,aAAa,CAACM,YAAY,CAACC,OAAO,CAACC,GAAG,CAClC,KAAM,CAAAC,GAAG,EAAI,CACT,KAAM,CAAAC,IAAI,CAAGnB,SAAS,CAACM,UAAU,CAACQ,MAAM,CAAC,CACzC,KAAM,CAAAM,SAAS,CAAGnB,KAAK,CAACoB,IAAI,CAACF,IAAI,CAACG,GAAG,CAAC,CAACC,IAAI,CAACtB,KAAK,CAAC,CAAC,CAAC,CAAG,CAAC,CAExD,GAAI,CAACmB,SAAS,CAAE,MAAO,CAAAF,GAAG,CAE1B,KAAM,CAAAM,QAAQ,CAAG,KAAM,CAAAzB,KAAK,CAAC0B,IAAI,IAAAZ,MAAA,CAAIT,OAAO,mBAAkB,CAC1DsB,OAAO,CAAEpB,UAAU,CAACoB,OACxB,CAAC,CAAC,CACFC,YAAY,CAACC,OAAO,CAAC,YAAY,CAAEC,IAAI,CAACC,SAAS,CAACN,QAAQ,CAACO,IAAI,CAAC,CAAC,CAEjEvB,aAAa,CAACgB,QAAQ,CAACO,IAAI,CAAC,CAC5BxB,OAAO,CAACP,SAAS,CAACwB,QAAQ,CAACO,IAAI,CAACjB,MAAM,CAAC,CAAC,CAExCI,GAAG,CAACP,OAAO,CAACC,aAAa,WAAAC,MAAA,CAAab,SAAS,CAACwB,QAAQ,CAACO,IAAI,CAACjB,MAAM,CAAC,CAAE,CAEvE,MAAO,CAAAI,GAAG,CACd,CACJ,CAAC,CAED,MAAO,CAAAT,aAAa,CACxB,CAAC,CAED,cAAe,CAAAJ,QAAQ"},"metadata":{},"sourceType":"module","externalDependencies":[]}